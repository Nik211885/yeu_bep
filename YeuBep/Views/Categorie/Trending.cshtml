@using Mapster
@using Microsoft.EntityFrameworkCore
@using YeuBep.Data
@using YeuBep.Entities
@using YeuBep.Helpers
@using YeuBep.ViewModels.Category
@inject YeuBepDbContext DbContext
@model List<YeuBep.ViewModels.Recipe.RecipeViewModel>
@{
    var countRecipeResult = await DbContext.Recipes
        .GroupBy(_ => 1)
        .Select(g => new
        {
            CountViewRecipes = g.Sum(x => x.Views),
            CountRecipe = g.Count(x => x.RecipeStatus == RecipeStatus.Accept)
        })
        .FirstAsync();
    var countCategory = await DbContext.Categories.Where(x => x.IsActive)
        .CountAsync();
    var topCategories = await DbContext.Categories
        .Where(x => x.IsActive)
        .OrderByDescending(x => x.CountRecipe)
        .ThenByDescending(x=>x.CreatedDate)
        .ProjectToType<CategoryViewModel>()
        .Take(3)
        .ToListAsync();
}
<link rel="stylesheet" href="~/css/categories/trending.css" />
<div class="page-header">
        <div class="header-content">
            <h1 class="page-title">🍺 Danh Mục Đang Hot</h1>
            <p class="page-subtitle">🔥Khám phá những món ăn được tìm kiếm và yêu thích nhiều nhất🍻</p>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="container">
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-number">@StringHelper.ConvertToStringValue(countRecipeResult.CountViewRecipes)</span>
                <span class="stat-label">Lượt xem</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">@StringHelper.ConvertToStringValue(countRecipeResult.CountRecipe)</span>
                <span class="stat-label">Công thức</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">@StringHelper.ConvertToStringValue(countCategory)</span>
                <span class="stat-label">Danh mục hot</span>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-tabs">
                <button class="filter-tab active">Tất cả</button>
                <button class="filter-tab">Hôm nay</button>
                <button class="filter-tab">Tuần này</button>
                <button class="filter-tab">Tháng này</button>
            </div>
            <div class="view-toggle">
                <button class="view-btn active">
                    <i class="bi bi-grid-3x3-gap"></i>
                </button>
                <button class="view-btn">
                    <i class="bi bi-list"></i>
                </button>
            </div>
        </div>

        <!-- Trending Grid -->
        <div class="trending-grid">
            <!-- Card 1 - Top 1 -->
            @for (int i = 0; i < Model.Count(); i++)
            {
                var recipe = Model.ElementAt(i);
                <a href="@Url.Action("Slug", "Recipe", new {slug = recipe.Slug})" class="trending-card">
                    <div class="trending-rank top-@(i+1)">@(i+1)</div>
                    <div class="card-image">
                        <img class="card-image" src="@recipe.Avatar" alt=""/>
                    </div>
                    <div class="card-content">
                        @foreach (var category in recipe.CategoriesCollection)
                        {
                            <div class="card-category">@category</div>
                        }
                        <h3 class="card-title">@recipe.Title</h3>
                        <span class="card-title fs-6 fw-light">@StringHelper.SplitWord( @recipe.Description)</span>
                        <div class="card-stats py-2">
                            <span class="card-stat fw-bold">
                                Lượt xem<i class="bi bi-eye-fill"></i> @StringHelper.ConvertToStringValue(recipe.Views)
                            </span>
                        </div>
                        <div class="trending-info">
                            <span class="growth">
                               
                            </span>
                            <span class="view-link">
                                Xem chi tiết <i class="bi bi-arrow-right"></i>
                            </span>
                        </div>
                    </div>
                </a>
            }
        </div>
        <!-- Rising Stars Section -->
        <div class="rising-section">
            <div class="rising-header">
                <h2 class="rising-title">⭐ Đang Lên Ngôi</h2>
                <p style="color: #636e72;">Những danh mục đang tăng trưởng mạnh mẽ</p>
            </div>
            <div class="rising-list">
                @for(int i = 0; i< topCategories.Count; i++)
                {
                    var category = topCategories.ElementAt(i);
                    <a href="@Url.Action("Slug","Category", new {slug = category.Slug})" class="rising-item">
                        <span class="rising-number">@(i+1)</span>
                        <img class="rising-icon" src="@category.Avatar" alt=""/>
                        <div class="rising-content">
                            <div class="rising-name" style="width: max-content">@category.Title</div>
                            <div class="rising-count">@category.CountRecipe công thức</div>
                        </div>
                        <span class="rising-arrow">↗ @Random.Shared.Next(50,150)%</span>
                    </a>
                }
            </div>
        </div>
    </div>